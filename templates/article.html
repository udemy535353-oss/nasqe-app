{% extends "layout.html" %}

{% block title %}
{% if article %}
{{ article.title }}
{% else %}
Makale Bulunamadı
{% endif %}
{% endblock %}

{% block gui %} {# 'gui' yerine 'body' bloğunu kullandığınızdan emin olun, layout.html'e göre #}
<br>
<br>
<br>
    <div class="container mt-4">
        {% if article %}
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="card-title">{{ article.title }}</h2>
                    <h6 class="card-subtitle text-muted">Yazar: {{ article.author }}</h6>
                    <small class="text-muted">Tarih: {{ article.date }}</small>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ article.content | safe }}</p>
                </div>
            </div>
            <hr>
            <br>
            <style>
                body {
                    background-color: black;
                }
                .prop {
                    color:white;
                }
                .card-header {
                    
                    background: linear-gradient(90deg, #d7e6ff 6.02%, #c7e4ff 51.92%, #dce2ff 96.44%);
                    border-radius:44px;
                }
                .btn {
                    background: black;
                    color:white;
                }
                .ops {
                    color: white !important;
                }
                svg {
                    color:white;
                    width:20px;
                    height:20px;
                }
                .btn {
                    box-shadow: 0 0 5px;
                    transition: all 0.5s ease;
                    
                    background: 
        linear-gradient(90.8deg, #3186ff -1.06%, #346bf1 45.45%, #4fa0ff 97.12%) padding-box,
        linear-gradient(60deg, #00f, #00e8ff) border-box;
                }
                
            </style>
            
            {% if copy==1 %}
                <a href= "/dislike/{{article.id}}" class="ewq"><i style="font-size:24px" class="fa">&#xf004;</i></a>
                <div class="yuppi">
                    <p class="rey">{{article.like}}</p>
                </div>
                <style>
                    .fa {
                        
                        align-items: center;
                        justify-content: center;
                        display:flex;
                        text-align: center;
        
        
        
                    }
                    .fa:hover {
                        color:rgb(255, 0, 34);
                        transition: color 0.4s ease;
                        cursor:pointer;

                    }
                    .ewq {
                        color:rgb(212, 38, 38);
                        text-decoration: none;
                    }
                    .ewq:hover {
                        text-decoration: none;
                        color:rgb(212, 38, 38);
                    }
                    .rey {
                        
                        text-align: center !important;
                        
                        justify-content: center;
                        
                    }
                    .yuppi{
                        text-align:center !important;
                    }


                </style>
            {% else %}
            <a href= "/like/{{article.id}}" class="ewq"><i style="font-size:24px" class="fa">&#xf004;</i></a>
            <div class="yupp">
                <p class="rey">{{article.like}}</p>
            </div>
            <style>
                    .fa {
                        align-items: center;
                        justify-content: center;
                        display:flex;
                        text-align: center;
        
        
                    }
                    .fa:hover {
                        color:rgb(231, 12, 12);
                        transition: color 0.4s ease;
                        cursor:pointer;

                    }
                    .ewq {
                        color:white;
                        text-decoration: none;
                    }
                    .ewq:hover {
                        text-decoration: none;
                        color:white;
                    }
                    .rey {
                        
                        text-align: center !important ;
                        justify-content: center;
                        color:White;
                        
                    }
                    .yuppi {
                        text-align: center;
                    }


                </style>
            {% endif %}
                


            <hr>

            {# Yorumlar bölümü için bir düğme ve modal tetikleyici #}
            {# comments listesinin dolu olup olmadığını kontrol et ve uzunluğunu al #}
            <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#commentsModal">
                <svg class = "ep"xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 30 30"
style="fill:#FFFFFF;">
    <path d="M 15 3 C 7.82 3 2 7.925 2 14 C 2 17.368 3.7933281 20.378484 6.6113281 22.396484 C 6.6832805 23.932468 6.4452784 26.053382 4.3261719 27.03125 A 0.5 0.5 0 0 0 4.3222656 27.033203 A 0.5 0.5 0 0 0 4 27.5 A 0.5 0.5 0 0 0 4.5 28 C 4.5119372 28 4.5232366 27.998109 4.5351562 27.998047 A 0.5 0.5 0 0 0 4.5429688 27.998047 C 6.9769949 27.982445 9.0432734 26.667034 10.46875 25.277344 C 10.92075 24.836344 11.550875 24.619328 12.171875 24.736328 C 13.081875 24.909328 14.028 25 15 25 C 22.18 25 28 20.075 28 14 C 28 7.925 22.18 3 15 3 z"></path>
</svg> ({{ comments|length if comments else 0 }})
            </button>

            {# Yorum ekleme formu #}
            <h3 class="prop">Yorum Ekle</h3>
            {% from "includes/formhelpers.html" import render_field %}
            <form method="post" action="/article/{{ article.id }}" novalidate id="addCommentForm"> {# action eklendi #}
              <dl>
                <div class="mb-3 form-group">
                    {{ render_field(form.content, class="form-control", placeholder="Yorumunuzu buraya yazın...", id="comment_content") }}
                    {% if form.content.errors %}
                        {% for error in form.content.errors %}
                            <div class="validation-message text-danger">
                                <span class="icon">!</span> {{ error }}
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
              </dl>
              <button type="submit" class="btn btn-success">Yorum Gönder</button>
            </form>

            {# Yorumlar Modalı #}
            <div class="modal fade" id="commentsModal" tabindex="-1" aria-labelledby="commentsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg"> {# Daha geniş bir modal için modal-lg #}
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="commentsModalLabel">Yorumlar</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            {% if comments %}
                                {% for comment_item in comments %}
                                    <div class="card mb-2">
                                        <div class="card-body">
                                            {% if comment_item.author.startswith('@') %}
                                                <h5 class="card-title at-user">{{ comment_item.author }}</h5>
                                            {% else %}
                                                <h5 class="card-title">{{ comment_item.author }}</h5>
                                            {% endif %}

                                            <h6 class="card-subtitle mb-2 text-muted">{{ comment_item.date }}</h6>
                                            <p class="card-text">{{ comment_item.content | safe }}</p>

                                            {# Yorumu sadece yorumu yapan kişi ve admin silebilir #}
                                            {% if session["logged_in"] and session["id"] == comment_item.user_id %}
                                                <a href="/deletecomment/{{ comment_item.id }}/{{ article.id }}" class="btn btn-sm btn-outline-danger float-end" onclick="return confirm('Bu yorumu silmek istediğinizden emin misiniz?');">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                                    </svg>
                                                    Sil
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p>Henüz yorum bulunmamaktadır.</p>
                            {% endif %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                        </div>
                    </div>
                </div>
            </div>

        {% else %}
            <div class="alert alert-warning" role="alert">
                Makale bulunamadı.
            </div>
        {% endif %}
    </div>

{% endblock gui %}