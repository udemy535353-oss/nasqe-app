{% extends "layout.html" %}

{% block title %}
İmages
{% endblock %}

{% block gui %}

<div class="side-menu d-none d-lg-block">
    <h3 class="brand-menu">Nasqe</h3>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link active" href="#">
                <i class="fa fa-home"></i> Anasayfa
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/"  >
                <i class="fa fa-compass"></i> Keşfet
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/inbox"  >
                <i class="fa fa-envelope"></i> Mesajlar
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#bildirimlerModal">
                <i class="fa fa-bell"></i> Bildirimler
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/profile/{{id}}" >
                <i class="fa fa-user"></i> Profil
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/settings" >
                <i class="fa fa-cog"></i> Ayarlar
            </a>
        </li>
    </ul>
</div>


<div class="main-content">
    <div class="container-fluid bg-info text-white p-5">
        <h1 class="brand">Nasqe</h1>
        <form action="/search" method="post">
            <input type="text" placeholder="Bir makale ara" class="main" name="keyword">
            <button type="submit" class="voic">Search</button>
        </form>
    </div>
    <br><br><br>
    {% if all %}
    <div class="card-container d-flex flex-column align-items-center gap-5">
        {% for image in all %}
        <div class="post-card">
            <div class="post-header d-flex align-items-center">
                <img src="{{ url_for('static', filename=image.profile) }}" alt="Profile Image" class="profile-img">
                <div class="header-info ms-3">
                    <h5 class="post-title">{{ image.sender }}</h5>
                    <small class="text-muted">{{ image.date }}</small>
                </div>
            </div>
            <div class="post-body mt-3">
                <div class="post-image-container">
                    {{ image.html_code | safe }}
                </div>
            </div>
            <div class="post-footer mt-3">
                <p class="post-description">{{ image.think }}</p>
            </div>
            <a type = "button" href="/likeutf/{{image.id}}" class="burnor"><i style="font-size:24px" class="fa">&#xf004;</i></a>
            <p class="likeu">{{ image.like }} </p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-muted">Henüz hiç gönderi yok.</p>
    {% endif %}
</div>


<div class="mobile-nav d-lg-none">
    <a href="#" class="mobile-nav-item active">
        <i class="fa fa-home"></i>
        <span>Anasayfa</span>
    </a>
    <a href="#" class="mobile-nav-item" data-bs-toggle="modal" data-bs-target="#kesfetModal">
        <i class="fa fa-compass"></i>
        <span>Keşfet</span>
    </a>
    <a href="#" class="mobile-nav-item" data-bs-toggle="modal" data-bs-target="#mesajlarModal">
        <i class="fa fa-envelope"></i>
        <span>Mesajlar</span>
    </a>
    <a href="#" class="mobile-nav-item" data-bs-toggle="modal" data-bs-target="#profilModal">
        <i class="fa fa-user"></i>
        <span>Profil</span>
    </a>
</div>


<div class="modal fade" id="kesfetModal" tabindex="-1" aria-labelledby="kesfetModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="kesfetModalLabel">Keşfet</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Burası Keşfet içeriğinin, popüler gönderilerin ve önerilen kullanıcıların gösterileceği yerdir.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="mesajlarModal" tabindex="-1" aria-labelledby="mesajlarModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="mesajlarModalLabel">Mesajlar</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Gelen kutunuz ve özel mesajlarınız burada listelenecektir.</p>
        <ul class="list-group">
          <li class="list-group-item">Ahmet'ten yeni mesaj.</li>
          <li class="list-group-item">Zeynep bir fotoğraf gönderdi.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="bildirimlerModal" tabindex="-1" aria-labelledby="bildirimlerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="bildirimlerModalLabel">Bildirimler</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Son bildirimleriniz aşağıdadır:</p>
        {% if compile %}
        <div class="alert alert-info" role="alert">
          {% for note in compile %}
          
            <img src="{{ url_for('static', filename=note.profile) }}" alt="Profil" class="modal-profile-pic mr-3"> 
            <p><strong>{{ note.sender }}:</strong> {{ note.topic }}  
            
          {% endfor %}
        {% else %}
        <p>Yeni bildiriminiz yok.</p>
        {% endif %}
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="profilModal" tabindex="-1" aria-labelledby="profilModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="profilModalLabel">Profil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Kullanıcı profili düzenleme ve görüntüleme seçenekleri burada yer alacak.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
        <button type="button" class="btn btn-primary">Değişiklikleri Kaydet</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="ayarlarModal" tabindex="-1" aria-labelledby="ayarlarModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ayarlarModalLabel">Ayarlar</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Uygulama ve hesap ayarlarını buradan yönetebilirsiniz.</p>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" checked>
          <label class="form-check-label" for="flexSwitchCheckChecked">E-posta bildirimlerine izin ver</label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>

<style>
/* ... (Mevcut CSS kodlarınız burada değişmeden kalıyor) ... */
.side-menu { position: fixed; top: 0; left: 0; height: 100vh; width: 250px; background-color: #ffffff; padding-top: 20px; border-right: 1px solid #e0e0e0; box-shadow: 2px 0 10px rgba(0,0,0,0.05); z-index: 1000; }
.brand-menu { font-family: 'Product Sans Black', sans-serif !important; color: black; text-align: center; padding: 20px 0; font-size: 2.5rem; }
.side-menu .nav-link { color: #333; padding: 12px 25px; display: flex; align-items: center; font-size: 1.1rem; font-weight: 500; transition: background-color 0.3s, color 0.3s; text-decoration: none; border-radius: 8px; margin: 5px 15px; }
.side-menu .nav-link .fa { margin-right: 15px; font-size: 1.3rem; width: 25px; text-align: center; color: #555; transition: color 0.3s; }
.side-menu .nav-link:hover, .side-menu .nav-link.active { background-color: #f0f2f5; color: #078efb; }
.side-menu .nav-link:hover .fa, .side-menu .nav-link.active .fa { color: #078efb; }
.mobile-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background-color: #ffffff; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 1000; }
.mobile-nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #8e8e8e; text-decoration: none; flex-grow: 1; }
.mobile-nav-item.active { color: #078efb; }
.mobile-nav-item i { font-size: 1.4rem; margin-bottom: 2px; }
.mobile-nav-item span { font-size: 0.7rem; }
.main-content { padding: 20px; }
@media (min-width: 992px) { .main-content { margin-left: 250px; } }
@media (max-width: 991.98px) { .main-content { margin-left: 0; padding-bottom: 80px; } }
body { background-color: #F2F4F7; }
.post-card { background-color: #fff; border: 1px solid #dbdbdb; border-radius: 12px; box-shadow: none; padding: 0; width: 100%; max-width: 680px; transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; }
.post-header { padding: 15px; border-bottom: 1px solid #eee; }
.post-footer, .post-description { color: #333; font-size: 0.95rem; line-height: 1.5; padding: 0 15px 15px 15px; }
.profile-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }
.post-title { font-weight: bold; color: #000000; margin: 0; }
.post-image-container { width: 100%; max-height: 750px; overflow: hidden; display: flex; justify-content: center; align-items: center; background-color: #fafafa; }
.post-image-container img { width: 100%; height: auto; object-fit: cover; }
.main { width:70%; border: 2px solid white; border-radius:100px; padding:10px; }
.main:hover { background-color:rgb(216, 221, 220); border:#078efb; transition: all 0.5s ease; }
.voic { border-radius:50px; color:white; font-family: 'Product Sans Black', sans-serif !important; padding:10px; text-align: center; align-items: center; font-weight: inherit; background: linear-gradient(90deg,#078efb 0,#ac87eb 66.7%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; transition: transform 0.4s ease; box-sizing: border-box; border: 2px solid #078efb; box-shadow: 0 0 15px; }
.voic:hover { transform : scale(1.05); border: 2px solid rgb(30, 99, 179); }
.brand { margin: 10px; font-family: 'Product Sans Black', sans-serif !important; color:black; }
.container-fluid.bg-info { text-align:center; border-radius: 33px; background:transparent !important ; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); backdrop-filter: blur(2px) !important; margin-bottom: 20px; }
.likeu { margin-left:15px; color:black; display: inline-block; vertical-align: middle; font-weight: bold; }
.btn.btn-primary { background: transparent; border: none; color: #ff4d6d; transition: transform 0.2s ease; padding-left: 15px; }
.btn.btn-primary:hover { transform: scale(1.15); color: #ff0a3d; }
.modal-profile-pic {
    justify-content: center;
    align-items: center;
    display: flex;
    margin-bottom: 20px;
    width: 100px;
    height: 100px;
    border: 2px solid white;
    border-radius: 50%;
    object-fit: cover;
  }
</style>
<script>


document.addEventListener('DOMContentLoaded', () => {
    
   
    const likeBtns = document.querySelectorAll('.burnor'); 

    // Her bir butona tıklama dinleyicisi ekle
    likeBtns.forEach(button => {
        button.addEventListener('click', (event) => {
            
            
            const senderData = { 
                text: image.sender // SADECE BU DEĞER GÖNDERİLİYOR
            }; 

            fetch('/sendlk', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(senderData) 
            })
            .then(response => {
                if (!response.ok) {
                    // Sunucudan 4xx veya 5xx HTTP kodu gelirse hata fırlat
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success') {
                    console.log(`Beğeni başarılı. Gönderen ID: ${data.senderId}`);
                    
                } else {
                    console.error('Beğeni kaydedilemedi:', data.message);
                }
            })
            .catch(error => {
                console.error('Sunucuya bağlanırken veya işlem sırasında hata oluştu:', error);
            });

        });
    });
});
</script>
{% endblock %}